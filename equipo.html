<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="PP Football">
  <link rel="manifest" href="/db-futbol/manifest.json">
  <link rel="apple-touch-icon" href="icono.png">
  <title>Equipo</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* ... (Mantenemos tus estilos CSS intactos) ... */
    .team-container { width: 100%; margin: 30px auto; display: flex; flex-direction: column; gap: 20px; padding: 0 20px; flex: 1; justify-content: center; }
    .team-name { font-size: 1.8rem; text-align: center; color: white; background-color: #292929; padding: 25px; border-radius: 10px; font-weight: bold; }
    .titleInfo { font-size: 1rem; background-color: #444444; color: white; padding: 15px; border-radius: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
    .detailsDiv { display: flex; justify-content: space-around; gap: 10px; }
    .partido { display: flex; width: 100%; font-weight: bold; font-size: 1rem; background-color: #444444; color: white; padding: 15px; border-radius: 10px; align-items: center; justify-content: center; }
    .verde { color: #00ff88; }
    .nombreEquipo { font-size: 15px; text-align: center; }
  </style>
</head>
<body>
  <header class="navbar">
    <h1 class="logo">PP Football 2025/26</h1>
    <nav class="menu">
      <a href="index.html">Inicio</a>
      <a href="equipos.html">Equipos</a>
    </nav>
  </header>

  <div id="teamInfo" class="team-container"></div>

  <footer class="footer">
    <p>© 2025 PP Football. Todos los derechos reservados.</p>
  </footer>

  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
  import { firebaseConfig } from "./firebaseConfig.js";

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const params = new URLSearchParams(window.location.search);
  const teamName = params.get("team");
  const teamContainer = document.getElementById("teamInfo");

  // 1. Mapeo para los IDs de los documentos de seguimiento (Scraping)
  const mapeoIdsSeguimiento = {
    "equipo_sd_eibar_b": "equipo_eibar_b",
    "equipo_indartsu_club": "equipo_indartsu",
    "equipo_cd_derio": "equipo_derio",
    "equipo_fc_cartagena": "equipo_cartagena"
  };

  // 2. Mapeo para los IDs de la colección "Equipos" (Base de datos principal)
  const mapeoIdsEquiposBase = {
    "SD Eibar B": "EQ01",
    "CD Derio": "EQ02",
    "Indartsu Club": "EQ03",
    "FC Cartagena": "EQ04"
    // Añade aquí el resto según los tengas en Firebase
  };

  const crearIdDocSeguimiento = (tipo, nombre) => {
      const idOriginal = `${tipo}_${nombre.toLowerCase().replace(/\s+/g, '_').replace(/[^\w]/g, '')}`;
      return mapeoIdsSeguimiento[idOriginal] || idOriginal;
  };

  async function cargarEquipo() {
    if (!teamName) {
      teamContainer.innerHTML = "<p>No se especificó equipo.</p>";
      return;
    }

    // ID para seguimiento_futbol (ej: equipo_derio)
    const docStatsId = crearIdDocSeguimiento("equipo", teamName);
    const refStats = doc(db, "seguimiento_futbol", docStatsId);
    
    // ID para la colección Equipos (ej: EQ02)
    const idEquipoBase = mapeoIdsEquiposBase[teamName] || teamName;
    const refEquipoBase = doc(db, "Equipos", idEquipoBase);

    try {
      // Cargamos ambos documentos en paralelo
      const [snapStats, snapEquipoBase] = await Promise.all([
        getDoc(refStats),
        getDoc(refEquipoBase)
      ]);

      if (snapStats.exists()) {
        const dataStats = snapStats.data();
        
        // --- OBTENER NOMBRE REAL DE LA COLECCIÓN EQUIPOS ---
        let nombreOficial = teamName; 
        if (snapEquipoBase.exists()) {
          nombreOficial = snapEquipoBase.data().nombre; // Campo 'nombre' de la col Equipos
        }

        teamContainer.innerHTML = "";

        // --- 1. Título del Equipo ---
        const nameDiv = document.createElement("div");
        nameDiv.className = "team-name";
        nameDiv.textContent = nombreOficial;
        teamContainer.appendChild(nameDiv);

        const { ultimo, proximo } = dataStats;

        if (teamName != "Indartsu Club" && teamName != "FC Cartagena") {
          // --- 2. Bloque Último Partido ---
          if (ultimo) {
            const lastTitle = document.createElement("div");
            lastTitle.className = "titleInfo";

            var jornadaLimpia = ultimo.infoJornada
              .replace(/schedule/gi, '')
              .replace(/get_app/gi, '')
              .trim();

            jornadaLimpia = jornadaLimpia.replace(/(\d{1,2})\/(\d{1,2})\/(\d{4})/, (match, d, m, y) => {
                const dia = d.padStart(2, '0');
                const mes = m.padStart(2, '0');
                return `${dia}/${mes}/${y}`;
            });

            const jornada = jornadaLimpia.split(' - ')[0].split(' - ')[0];
            const fecha = jornadaLimpia.split(' - ')[1].split(' - ')[0];

            lastTitle.innerHTML = `<h3>${jornada} (${fecha})</h3>`;
            teamContainer.appendChild(lastTitle);

            const lastDetails = document.createElement("div");
            lastDetails.className = "detailsDiv";
            
            const esCasa = ultimo.rival.includes("(C)");
            const rivalLimpio = ultimo.rival.replace("(C)", "").replace("(F)", "").trim();

            lastDetails.innerHTML = `
                <div class="nombreEquipo partido ${esCasa ? 'verde' : ''}">${esCasa ? nombreOficial : rivalLimpio}</div>
                <div class="partido" style="font-size: 25px; font-style: italic; width: fit-content; white-space: nowrap;">${ultimo.resultado}</div>
                <div class="nombreEquipo partido ${!esCasa ? 'verde' : ''}">${!esCasa ? nombreOficial : rivalLimpio}</div>
            `;
            teamContainer.appendChild(lastDetails);
          }

          // --- 3. Bloque Próximo Partido ---
          if (proximo) {
              const nextTitle = document.createElement("div");
              nextTitle.className = "titleInfo";

              var jornadaLimpia = proximo.infoJornada
                  .replace(/schedule/gi, '')
                  .replace(/get_app/gi, '')
                  .trim();

              jornadaLimpia = jornadaLimpia.replace(/(\d{1,2})\/(\d{1,2})\/(\d{4})/, (match, d, m, y) => {
                  const dia = d.padStart(2, '0');
                  const mes = m.padStart(2, '0');
                  return `${dia}/${mes}/${y}`;
              });

              const jornada = jornadaLimpia.split(' - ')[0];
              let fecha = jornadaLimpia.split(' - ')[1];

              // --- LÓGICA DE RESTAR DÍA SI ES SÁBADO (S-) ---
              if (proximo.resultado.includes("S-")) {
                  // 1. Extraer día, mes y año del string "DD/MM/YYYY"
                  const [d, m, y] = fecha.split('/').map(Number);
                  // 2. Crear objeto fecha (el mes en JS empieza en 0, por eso m-1)
                  let fechaObj = new Date(y, m - 1, d);
                  // 3. Restar un día
                  fechaObj.setDate(fechaObj.getDate() - 1);
                  // 4. Volver a formatear a "DD/MM/YYYY"
                  const nuevoDia = String(fechaObj.getDate()).padStart(2, '0');
                  const nuevoMes = String(fechaObj.getMonth() + 1).padStart(2, '0');
                  const nuevoAnio = fechaObj.getFullYear();
                  fecha = `${nuevoDia}/${nuevoMes}/${nuevoAnio}`;
              }

              function formatearFecha(fechaSucio) {
                  // Dividimos la fecha por "/" (ej: "1/2/26" -> ["1", "2", "26"])
                  const partes = fechaSucio.split('/');
                  
                  if (partes.length !== 3) return fechaSucio; // Si no tiene el formato esperado, devolver original

                  const dia = partes[0].padStart(2, '0');  // Asegura 2 dígitos (1 -> 01)
                  const mes = partes[1].padStart(2, '0');  // Asegura 2 dígitos (2 -> 02)
                  let anio = partes[2];

                  // Si el año solo tiene 2 dígitos (26), le ponemos el 20 delante
                  if (anio.length === 2) {
                      anio = "20" + anio;
                  }

                  return `${dia}/${mes}/${anio}`;
              }

              function convertirHora24h(stringSucio) {
                  // 1. Extraemos la parte de la hora y el meridiano (ej: "6:00 PM")
                  const match = stringSucio.match(/(\d{1,2}):(\d{2})\s?(AM|PM)/i);
                  if (!match) return null;

                  let [_, horas, minutos, meridiano] = match;
                  horas = parseInt(horas);

                  // 2. Lógica de conversión
                  if (meridiano.toUpperCase() === 'PM' && horas < 12) {
                      horas += 12;
                  } else if (meridiano.toUpperCase() === 'AM' && horas === 12) {
                      horas = 0;
                  }

                  // 3. Formateamos con ceros a la izquierda (ej: "06:00" o "18:00")
                  const horaFinal = horas.toString().padStart(2, '0');
                  return `${horaFinal}:${minutos}`;
              }

              // Ahora limpiamos el resultado para el HTML
              proximo.resultado = proximo.resultado.replace("S-", "");
              proximo.resultado = proximo.resultado.replace("D-", "");

              nextTitle.innerHTML = `<h3>${jornada} (${teamName == "CD Derio" ? formatearFecha(proximo.resultado.split(" ")[0]) : proximo.resultado.split(" ")[0]})</h3>`;
              teamContainer.appendChild(nextTitle);

              const nextDetails = document.createElement("div");
              nextDetails.className = "detailsDiv";

              const esCasaProx = proximo.rival.includes("(C)");
              const rivalProxLimpio = proximo.rival.replace("(C)", "").replace("(F)", "").trim();

              nextDetails.innerHTML = `
                  <div class="nombreEquipo partido ${esCasaProx ? 'verde' : ''}">${esCasaProx ? nombreOficial : rivalProxLimpio}</div>
                  <div class="partido" style="font-size: 25px; font-style: italic; width: fit-content;">${teamName == "CD Derio" ? proximo.resultado.split(" ")[1] : convertirHora24h(proximo.resultado)}</div>
                  <div class="nombreEquipo partido ${!esCasaProx ? 'verde' : ''}">${!esCasaProx ? nombreOficial : rivalProxLimpio}</div>
              `;
              teamContainer.appendChild(nextDetails);
          }

          function nombreClasif(nombre) {
            if (nombre == "CD Derio") return "cd_derio";
            if (nombre == "SD Eibar B") return "eibar_b";
          }

          try {
            const refClas = doc(db, "seguimiento_futbol", `clasificacion_${nombreClasif(teamName)}`);
            const snapClas = await getDoc(refClas);

            if (snapClas.exists()) {
              const data = snapClas.data();
              const tablaData = data.tabla;
              const nextTitle = document.createElement("div");
              nextTitle.className = "titleInfo";
              nextTitle.innerHTML = `<h3>CLASIFICACIÓN</h3>`;
              teamContainer.appendChild(nextTitle);

              const containerClasificacion = document.createElement("div");
              containerClasificacion.style.padding = "10px";
              containerClasificacion.style.borderRadius = "10px";
              containerClasificacion.style.backgroundColor = "#444444";
              teamContainer.appendChild(containerClasificacion);

              const containerFila1 = document.createElement("div");
              // 1. Forzamos a que sea una fila horizontal que ocupe todo el ancho
              containerFila1.style.display = "flex";
              containerFila1.style.width = "100%";
              containerFila1.style.alignItems = "center";
              containerFila1.style.marginBottom = "10px";
              containerFila1.style.padding = "0";

              const posi = document.createElement("div");
              const nombre = document.createElement("div");
              const puntos = document.createElement("div");

              // posi.style.minWidth = "30px" // Ancho fijo para que todos los números queden alineados
              posi.style.fontWeight = "bold";
              posi.style.backgroundColor = "#292929"
              posi.style.borderRadius = "10px";
              posi.style.width = "18%";
              posi.style.height = "50px";
              posi.style.display = "flex";
              posi.style.alignItems = "center";   // Centrado vertical
              posi.style.justifyContent = "center"; // Centrado horizontal
              posi.innerHTML = `POS`;

              nombre.style.flexGrow = "1";
              nombre.style.textAlign = "left";
              nombre.style.backgroundColor = "#292929"
              nombre.style.borderRadius = "10px";
              nombre.style.marginLeft = "5px";
              nombre.style.paddingLeft = "15px";
              nombre.style.height = "50px";
              nombre.style.display = "flex";
              nombre.style.alignItems = "center";
              nombre.style.fontWeight = "bold";
              nombre.innerHTML = "EQUIPO";

              puntos.style.width = "18%";
              puntos.style.fontWeight = "bold";
              puntos.style.backgroundColor = "#292929"
              puntos.style.borderRadius = "10px";
              puntos.style.height = "50px";
              puntos.style.display = "flex";
              puntos.style.alignItems = "center";   // Centrado vertical
              puntos.style.justifyContent = "center"; // Centrado horizontal
              puntos.style.marginLeft = "5px";
              puntos.innerHTML = `PTS`;

              containerFila1.appendChild(posi);
              containerFila1.appendChild(nombre);
              containerFila1.appendChild(puntos);

              containerClasificacion.appendChild(containerFila1);

              let posicion = 1;

              tablaData.forEach(element => {
                const containerFila = document.createElement("div");
                // 1. Forzamos a que sea una fila horizontal que ocupe todo el ancho
                containerFila.style.display = "flex";
                containerFila.style.width = "100%";
                containerFila.style.alignItems = "center";
                containerFila.style.marginBottom = "10px";
                containerFila.style.padding = "0"; 
                // containerFila.style.backgroundColor = "#333333";
                
                // Opcional: añade tu clase para que tenga el fondo gris que usas en otros lados
                containerFila.className = "partido"; 

                const pos = document.createElement("div");
                // pos.style.minWidth = "fit-content"
                pos.style.fontWeight = "bold";
                pos.style.backgroundColor = "#333333"
                pos.style.borderRadius = "10px";
                pos.style.width = "18%";
                pos.style.height = "50px";
                pos.style.display = "flex";
                pos.style.alignItems = "center";   // Centrado vertical
                pos.style.justifyContent = "center"; // Centrado horizontal
                pos.innerHTML = `${posicion++}`;
                if (element.nombre == "S.D. Eibar B" || element.nombre == "C.D. Derio") {
                  pos.classList.add("verde");
                }
                if (teamName == "SD Eibar B") {
                  if (posicion > 14) {
                    pos.style.backgroundColor = "#552222";
                  } else if (posicion < 3) {
                    pos.style.backgroundColor = "#113311";
                  } else if (posicion < 7) {
                    pos.style.backgroundColor = "#448844";
                  } else if (posicion > 13) {
                    pos.style.backgroundColor = "#CCAA55";
                  }
                } else if (teamName == "CD Derio") {
                  if (posicion > 16) {
                    pos.style.backgroundColor = "#552222";
                  } else if (posicion < 3) {
                    pos.style.backgroundColor = "#113311";
                  } else if (posicion < 7) {
                    pos.style.backgroundColor = "#448844";
                  }
                }
                containerFila.appendChild(pos);

                const nombreEq = document.createElement("div");
                // 2. Usamos flex-grow para que el nombre ocupe el espacio restante
                nombreEq.style.flexGrow = "1";
                nombreEq.style.textAlign = "left";
                nombreEq.style.backgroundColor = "#333333"
                nombreEq.style.borderRadius = "10px";
                nombreEq.style.marginLeft = "5px";
                nombreEq.style.paddingLeft = "15px";
                nombreEq.style.height = "50px";
                nombreEq.style.display = "flex";
                nombreEq.style.alignItems = "center";   // Centrado vertical
                
                const nombreLimpio = element.nombre.replace(/"/g, '').replace(".", "").replace(".", "").replace(".", "").trim();
                nombreEq.innerHTML = nombreLimpio;
                if (element.nombre == "S.D. Eibar B" || element.nombre == "C.D. Derio") {
                  nombreEq.classList.add("verde");
                }
                containerFila.appendChild(nombreEq);

                const puntos = document.createElement("div");
                let pts = parseInt(element.Empatados) + parseInt((element.Ganados * 3));
                puntos.innerHTML = `${pts}`;
                puntos.style.width = "18%";
                puntos.style.fontWeight = "bold";
                puntos.style.backgroundColor = "#333333"
                puntos.style.borderRadius = "10px";
                puntos.style.height = "50px";
                puntos.style.display = "flex";
                puntos.style.alignItems = "center";   // Centrado vertical
                puntos.style.justifyContent = "center"; // Centrado horizontal
                puntos.style.marginLeft = "5px";
                if (element.nombre == "S.D. Eibar B" || element.nombre == "C.D. Derio") {
                  puntos.classList.add("verde");
                }

                if (teamName == "SD Eibar B") {
                    if (posicion > 14) {
                      puntos.style.backgroundColor = "#552222";
                    } else if (posicion < 3) {
                      puntos.style.backgroundColor = "#113311";
                    } else if (posicion < 7) {
                      puntos.style.backgroundColor = "#448844";
                    } else if (posicion > 13) {
                      puntos.style.backgroundColor = "#CCAA55";
                    }
                  } else if (teamName == "CD Derio") {
                    if (posicion > 16) {
                      puntos.style.backgroundColor = "#552222";
                    } else if (posicion < 3) {
                      puntos.style.backgroundColor = "#113311";
                    } else if (posicion < 7) {
                      puntos.style.backgroundColor = "#448844";
                    }
                  }

                if (teamName == "SD Eibar B") {
                    if (posicion > 14) {
                    nombreEq.style.backgroundColor = "#552222";
                  } else if (posicion < 3) {
                    nombreEq.style.backgroundColor = "#113311";
                  } else if (posicion < 7) {
                    nombreEq.style.backgroundColor = "#448844";
                  } else if (posicion > 13) {
                    nombreEq.style.backgroundColor = "#CCAA55";
                  }
                } else if (teamName == "CD Derio") {
                  if (posicion > 16) {
                    nombreEq.style.backgroundColor = "#552222";
                  } else if (posicion < 3) {
                    nombreEq.style.backgroundColor = "#113311";
                  } else if (posicion < 7) {
                    nombreEq.style.backgroundColor = "#448844";
                  }
                }

                containerFila.appendChild(puntos);

                containerFila.addEventListener("click", () => {
                  const pj = element.Jugados;
      
                  const pg = parseInt(element.Ganados);
                  const pe = parseInt(element.Empatados);
                  const pp = parseInt(element.Perdidos);

                  // Verificamos si ya estamos mostrando las estadísticas buscando un ID o clase específica
                  const yaExpandido = nombreEq.querySelector(".stats-container");

                  if (yaExpandido) {
                      // Si ya está expandido, volvemos al estado original
                      nombreEq.style.flexGrow = "1";
                      nombreEq.style.textAlign = "left";
                      nombreEq.style.backgroundColor = cargarColorPref(pos.innerText, teamName);
                      nombreEq.style.borderRadius = "10px";
                      nombreEq.style.marginLeft = "5px";
                      nombreEq.style.paddingLeft = "15px";
                      nombreEq.style.height = "50px";
                      nombreEq.style.display = "flex";
                      nombreEq.style.alignItems = "center"; 
                      nombreEq.style.flexDirection = "row";
                      
                      pos.style.height = "50px";
                      puntos.style.height = "50px";
                      nombreEq.innerHTML = element.nombre.replace(/"/g, '').replace(".", "").replace(".", "").replace(".", "").trim();
                  } else {
                      // Aumentamos la altura para que quepan las 3 líneas (Nombre + PJ + G/E/P)
                      nombreEq.style.height = "auto"; 
                      nombreEq.style.paddingTop = "10px";
                      nombreEq.style.paddingBottom = "10px";
                      nombreEq.style.paddingRight = "15px";

                      nombreEq.style.display = "flex";
                      nombreEq.style.flexDirection = "column";

                      nombreEq.innerHTML = `
                          <span style="font-size: 1rem; font-weight: bold; margin-bottom: 12px; color: ${element.nombre === "S.D. Eibar B" || element.nombre === "C.D. Derio" ? "#00ff88" : "white"}; width: 100%; text-align: left; text-decoration: underline;">
                              ${element.nombre.replace(/"/g, '').replace(".", "").replace(".", "").replace(".", "").trim()}
                          </span>

                          <div style="position: relative; width: 100%; padding: 15px 10px 10px 10px; border: 2px solid ${element.nombre === "S.D. Eibar B" || element.nombre === "C.D. Derio" ? "#00ff88" : "white"}; border-radius: 8px; margin-top: 5px;">
                              
                              <span style="position: absolute; top: -10px; left: 10px; background-color: ${cargarColorPref(pos.innerText, teamName)}; padding: 0 5px; font-size: 0.8rem; color: ${element.nombre === "S.D. Eibar B" || element.nombre === "C.D. Derio" ? "#00ff88" : "white"};">
                                  <strong>Jugados: </strong><i>${pj}</i>
                              </span>
                              
                              <div class="stats-container" style="display: flex; flex-direction: column; gap: 8px;">
                                  <div style="display: flex; width: 100%; font-size: 0.75rem; color: ${element.nombre === "S.D. Eibar B" || element.nombre === "C.D. Derio" ? "#00ff88" : "white"};">
                                      <span style="flex: 1;"><strong>G:</strong> <i>${pg}</i></span>
                                      <span style="flex: 1; text-align: center;"><strong>E:</strong> <i>${pe}</i></span>
                                      <span style="flex: 1; text-align: right;"><strong>P:</strong> <i>${pp}</i></span>
                                  </div>

                                  <div style="display: flex; width: 100%; font-size: 0.75rem; color: ${element.nombre === "S.D. Eibar B" || element.nombre === "C.D. Derio" ? "#00ff88" : "white"}; border-top: 2px solid ${element.nombre === "S.D. Eibar B" || element.nombre === "C.D. Derio" ? "#00ff88" : "white"}; pt: 5px; margin-top: 2px; padding-top: 5px;">
                                      <span style="flex: 1;"><strong>GF:</strong> <i>${element.GolesFavor}</i></span>
                                      <span style="flex: 1; text-align: right;"><strong>GC:</strong> <i>${element.GolesContra}</i></span>
                                  </div>
                              </div>
                          </div>
                      `;

                      pos.style.height = nombreEq.scrollHeight + "px";
                      puntos.style.height = nombreEq.scrollHeight + "px";
                  }
                });

                containerClasificacion.appendChild(containerFila);
            });
            }
          } catch (error) {
            // Salta el bloque de clasificación si hay error
          }

        } else if (teamName == "FC Cartagena") {
          // --- 2. Bloque Último Partido ---
          if (ultimo) {
            const lastTitle = document.createElement("div");
            lastTitle.className = "titleInfo";

            var jornadaLimpia = ultimo.infoJornada
              .replace(/schedule/gi, '')
              .replace(/get_app/gi, '')
              .trim();

            jornadaLimpia = jornadaLimpia.replace(/(\d{1,2})\/(\d{1,2})\/(\d{4})/, (match, d, m, y) => {
                const dia = d.padStart(2, '0');
                const mes = m.padStart(2, '0');
                return `${dia}/${mes}/${y}`;
            });

            const jornada = jornadaLimpia.split(' - ')[0].split(' - ')[0];
            const fecha = jornadaLimpia.split(' - ')[1].split(' - ')[0];

            lastTitle.innerHTML = `<h3>${jornada} (${fecha})</h3>`;
            teamContainer.appendChild(lastTitle);

            const lastDetails = document.createElement("div");
            lastDetails.className = "detailsDiv";
            
            const esCasa = ultimo.rival.includes("(C)");
            const rivalLimpio = ultimo.rival.replace("(C)", "").replace("(F)", "").trim();

            lastDetails.innerHTML = `
                <div class="nombreEquipo partido ${esCasa ? 'verde' : ''}">${esCasa ? nombreOficial : rivalLimpio}</div>
                <div class="partido" style="font-size: 25px; font-style: italic; width: fit-content; white-space: nowrap;">${ultimo.resultado}</div>
                <div class="nombreEquipo partido ${!esCasa ? 'verde' : ''}">${!esCasa ? nombreOficial : rivalLimpio}</div>
            `;
            teamContainer.appendChild(lastDetails);
          }

          // --- 3. Bloque Próximo Partido ---
          if (proximo) {
            const nextTitle = document.createElement("div");
            nextTitle.className = "titleInfo";

            var jornadaLimpia = proximo.infoJornada
              .replace(/schedule/gi, '')
              .replace(/get_app/gi, '')
              .trim();

            jornadaLimpia = jornadaLimpia.replace(/(\d{1,2})\/(\d{1,2})\/(\d{4})/, (match, d, m, y) => {
                const dia = d.padStart(2, '0');
                const mes = m.padStart(2, '0');
                return `${dia}/${mes}/${y}`;
            });

            const jornada = jornadaLimpia.split(' - ')[0].split(' - ')[0];
            const fecha = jornadaLimpia.split(' - ')[1].split(' - ')[0];

            nextTitle.innerHTML = `<h3>${jornada} (${fecha})</h3>`;
            teamContainer.appendChild(nextTitle);

            const nextDetails = document.createElement("div");
            nextDetails.className = "detailsDiv";

            const esCasaProx = proximo.rival.includes("(C)");
            const rivalProxLimpio = proximo.rival.replace("(C)", "").replace("(F)", "").trim();
            proximo.resultado = proximo.resultado.replace("S-", "");
            proximo.resultado = proximo.resultado.replace("D-", "");

            function convertirHora24h(stringSucio) {
                  // 1. Extraemos la parte de la hora y el meridiano (ej: "6:00 PM")
                  const match = stringSucio.match(/(\d{1,2}):(\d{2})\s?(AM|PM)/i);
                  if (!match) return null;

                  let [_, horas, minutos, meridiano] = match;
                  horas = parseInt(horas);

                  // 2. Lógica de conversión
                  if (meridiano.toUpperCase() === 'PM' && horas < 12) {
                      horas += 12;
                  } else if (meridiano.toUpperCase() === 'AM' && horas === 12) {
                      horas = 0;
                  }

                  // 3. Formateamos con ceros a la izquierda (ej: "06:00" o "18:00")
                  const horaFinal = horas.toString().padStart(2, '0');
                  return `${horaFinal}:${minutos}`;
              }

            nextDetails.innerHTML = `
                <div class="nombreEquipo partido ${esCasaProx ? 'verde' : ''}">${esCasaProx ? nombreOficial : rivalProxLimpio}</div>
                <div class="partido" style="font-size: 25px; font-style: italic; width: fit-content;">${convertirHora24h(proximo.resultado)}</div>
                <div class="nombreEquipo partido ${!esCasaProx ? 'verde' : ''}">${!esCasaProx ? nombreOficial : rivalProxLimpio}</div>
            `;
            teamContainer.appendChild(nextDetails);
          }
          
          try {
            const refClas = doc(db, "seguimiento_futbol", `clasificacion_fc_cartagena`);
            const snapClas = await getDoc(refClas);

            if (snapClas.exists()) {
              const data = snapClas.data();
              const tablaData = data.tabla;
              const nextTitle = document.createElement("div");
              nextTitle.className = "titleInfo";
              nextTitle.innerHTML = `<h3>CLASIFICACIÓN</h3>`;
              teamContainer.appendChild(nextTitle);

              const containerClasificacion = document.createElement("div");
              containerClasificacion.style.padding = "10px";
              containerClasificacion.style.borderRadius = "10px";
              containerClasificacion.style.backgroundColor = "#444444";
              teamContainer.appendChild(containerClasificacion);

              const containerFila1 = document.createElement("div");
              // 1. Forzamos a que sea una fila horizontal que ocupe todo el ancho
              containerFila1.style.display = "flex";
              containerFila1.style.width = "100%";
              containerFila1.style.alignItems = "center";
              containerFila1.style.marginBottom = "10px";
              containerFila1.style.padding = "0";

              const posi = document.createElement("div");
              const nombre = document.createElement("div");
              const puntos = document.createElement("div");

              // posi.style.minWidth = "30px" // Ancho fijo para que todos los números queden alineados
              posi.style.fontWeight = "bold";
              posi.style.backgroundColor = "#292929"
              posi.style.borderRadius = "10px";
              posi.style.width = "18%";
              posi.style.height = "50px";
              posi.style.display = "flex";
              posi.style.alignItems = "center";   // Centrado vertical
              posi.style.justifyContent = "center"; // Centrado horizontal
              posi.innerHTML = `POS`;

              nombre.style.flexGrow = "1";
              nombre.style.textAlign = "left";
              nombre.style.backgroundColor = "#292929"
              nombre.style.borderRadius = "10px";
              nombre.style.marginLeft = "5px";
              nombre.style.paddingLeft = "15px";
              nombre.style.height = "50px";
              nombre.style.display = "flex";
              nombre.style.alignItems = "center";
              nombre.style.fontWeight = "bold";
              nombre.innerHTML = "EQUIPO";

              puntos.style.width = "18%";
              puntos.style.fontWeight = "bold";
              puntos.style.backgroundColor = "#292929"
              puntos.style.borderRadius = "10px";
              puntos.style.height = "50px";
              puntos.style.display = "flex";
              puntos.style.alignItems = "center";   // Centrado vertical
              puntos.style.justifyContent = "center"; // Centrado horizontal
              puntos.style.marginLeft = "5px";
              puntos.innerHTML = `PTS`;

              containerFila1.appendChild(posi);
              containerFila1.appendChild(nombre);
              containerFila1.appendChild(puntos);

              containerClasificacion.appendChild(containerFila1);

              let posicion = 1;

              tablaData.forEach(element => {
                const containerFila = document.createElement("div");
                // 1. Forzamos a que sea una fila horizontal que ocupe todo el ancho
                containerFila.style.display = "flex";
                containerFila.style.width = "100%";
                containerFila.style.alignItems = "center";
                containerFila.style.marginBottom = "10px";
                containerFila.style.padding = "0"; 
                // containerFila.style.backgroundColor = "#333333";
                
                // Opcional: añade tu clase para que tenga el fondo gris que usas en otros lados
                containerFila.className = "partido"; 

                const pos = document.createElement("div");
                // pos.style.minWidth = "fit-content"
                pos.style.fontWeight = "bold";
                pos.style.backgroundColor = "#333333"
                pos.style.borderRadius = "10px";
                pos.style.width = "18%";
                pos.style.height = "50px";
                pos.style.display = "flex";
                pos.style.alignItems = "center";   // Centrado vertical
                pos.style.justifyContent = "center"; // Centrado horizontal
                pos.innerHTML = `${posicion++}`;
                if (element.nombre == "F.C. Cartagena") {
                  pos.classList.add("verde");
                }
                if (posicion > 16) {
                  pos.style.backgroundColor = "#552222";
                } else if (posicion < 3) {
                  pos.style.backgroundColor = "#113311";
                } else if (posicion < 7) {
                  pos.style.backgroundColor = "#448844";
                }
                containerFila.appendChild(pos);

                const nombreEq = document.createElement("div");
                // 2. Usamos flex-grow para que el nombre ocupe el espacio restante
                nombreEq.style.flexGrow = "1";
                nombreEq.style.textAlign = "left";
                nombreEq.style.backgroundColor = "#333333"
                nombreEq.style.borderRadius = "10px";
                nombreEq.style.marginLeft = "5px";
                nombreEq.style.paddingLeft = "15px";
                nombreEq.style.height = "50px";
                nombreEq.style.display = "flex";
                nombreEq.style.alignItems = "center";   // Centrado vertical
                
                const nombreLimpio = element.nombre.replace(/"/g, '').replace(".", "").replace(".", "").replace(".", "").replace(".", "").trim();
                nombreEq.innerHTML = nombreLimpio;
                if (element.nombre == "F.C. Cartagena") {
                  nombreEq.classList.add("verde");
                }
                containerFila.appendChild(nombreEq);

                const puntos = document.createElement("div");
                let pts = parseInt(element.Empatados) + parseInt((element.Ganados * 3));
                puntos.innerHTML = `${pts}`;
                puntos.style.width = "18%";
                puntos.style.fontWeight = "bold";
                puntos.style.backgroundColor = "#333333"
                puntos.style.borderRadius = "10px";
                puntos.style.height = "50px";
                puntos.style.display = "flex";
                puntos.style.alignItems = "center";   // Centrado vertical
                puntos.style.justifyContent = "center"; // Centrado horizontal
                puntos.style.marginLeft = "5px";
                if (element.nombre == "F.C. Cartagena") {
                  puntos.classList.add("verde");
                }
                if (posicion > 16) {
                  puntos.style.backgroundColor = "#552222";
                } else if (posicion < 3) {
                  puntos.style.backgroundColor = "#113311";
                } else if (posicion < 7) {
                  puntos.style.backgroundColor = "#448844";
                }

                if (posicion > 16) {
                  nombreEq.style.backgroundColor = "#552222";
                } else if (posicion < 3) {
                  nombreEq.style.backgroundColor = "#113311";
                } else if (posicion < 7) {
                  nombreEq.style.backgroundColor = "#448844";
                }

                containerFila.appendChild(puntos);

                containerFila.addEventListener("click", () => {
                  const pj = element.Jugados;
      
                  const pg = parseInt(element.Ganados);
                  const pe = parseInt(element.Empatados);
                  const pp = parseInt(element.Perdidos);

                  // Verificamos si ya estamos mostrando las estadísticas buscando un ID o clase específica
                  const yaExpandido = nombreEq.querySelector(".stats-container");

                  if (yaExpandido) {
                      // Si ya está expandido, volvemos al estado original
                      nombreEq.style.flexGrow = "1";
                      nombreEq.style.textAlign = "left";
                      nombreEq.style.backgroundColor = cargarColorCart(pos.innerText);
                      nombreEq.style.borderRadius = "10px";
                      nombreEq.style.marginLeft = "5px";
                      nombreEq.style.paddingLeft = "15px";
                      nombreEq.style.height = "50px";
                      nombreEq.style.display = "flex";
                      nombreEq.style.alignItems = "center"; 
                      nombreEq.style.flexDirection = "row";
                      
                      pos.style.height = "50px";
                      puntos.style.height = "50px";
                      nombreEq.innerHTML = element.nombre.replace(/"/g, '').replace(".", "").replace(".", "").replace(".", "").trim();
                  } else {
                      // Aumentamos la altura para que quepan las 3 líneas (Nombre + PJ + G/E/P)
                      nombreEq.style.height = "auto"; 
                      nombreEq.style.paddingTop = "10px";
                      nombreEq.style.paddingBottom = "10px";
                      nombreEq.style.paddingRight = "15px";

                      nombreEq.style.display = "flex";
                      nombreEq.style.flexDirection = "column";

                      nombreEq.innerHTML = `
                          <span style="font-size: 1rem; font-weight: bold; margin-bottom: 12px; color: ${element.nombre === "F.C. Cartagena" ? "#00ff88" : "white"}; width: 100%; text-align: left; text-decoration: underline;">
                              ${element.nombre.replace(/"/g, '').replace(".", "").replace(".", "").replace(".", "").trim()}
                          </span>

                          <div style="position: relative; width: 100%; padding: 15px 10px 10px 10px; border: 2px solid ${element.nombre === "F.C. Cartagena" ? "#00ff88" : "white"}; border-radius: 8px; margin-top: 5px;">
                              
                              <span style="position: absolute; top: -10px; left: 10px; background-color: ${cargarColorCart(pos.innerText)}; padding: 0 5px; font-size: 0.8rem; color: ${element.nombre === "F.C. Cartagena" ? "#00ff88" : "white"};">
                                  <strong>Jugados: </strong><i>${pj}</i>
                              </span>
                              
                              <div class="stats-container" style="display: flex; flex-direction: column; gap: 8px;">
                                  <div style="display: flex; width: 100%; font-size: 0.75rem; color: ${element.nombre === "F.C. Cartagena" ? "#00ff88" : "white"};">
                                      <span style="flex: 1;"><strong>G:</strong> <i>${pg}</i></span>
                                      <span style="flex: 1; text-align: center;"><strong>E:</strong> <i>${pe}</i></span>
                                      <span style="flex: 1; text-align: right;"><strong>P:</strong> <i>${pp}</i></span>
                                  </div>

                                  <div style="display: flex; width: 100%; font-size: 0.75rem; color: ${element.nombre === "F.C. Cartagena" ? "#00ff88" : "white"}; border-top: 2px solid ${element.nombre === "F.C. Cartagena" ? "#00ff88" : "white"}; pt: 5px; margin-top: 2px; padding-top: 5px;">
                                      <span style="flex: 1;"><strong>GF:</strong> <i>${element.GolesFavor}</i></span>
                                      <span style="flex: 1; text-align: right;"><strong>GC:</strong> <i>${element.GolesContra}</i></span>
                                  </div>
                              </div>
                          </div>
                      `;

                      pos.style.height = nombreEq.scrollHeight + "px";
                      puntos.style.height = nombreEq.scrollHeight + "px";
                  }
                });

                containerClasificacion.appendChild(containerFila);
            });
            }
          } catch (error) {
            // Salta el bloque de clasificación si hay error
          }


        } else {
          // --- 2. Bloque Último Partido ---
        if (ultimo) {
          const lastTitle = document.createElement("div");
          lastTitle.className = "titleInfo";

          var jornadaLimpia = ultimo.infoJornada.split(' ')[0] + " " + ultimo.infoJornada.split(' ')[1]

          /* var fecha = ultimo.infoJornada.split(' ')[0].replace(/(\d{1,2})\/(\d{1,2})\/(\d{4})/, (match, d, m, y) => {
              const dia = d.padStart(2, '0');
              const mes = m.padStart(2, '0');
              return `${dia}/${mes}/${y}`;
          }); */

          var hora = ultimo.infoJornada.split(' ')[3];

          lastTitle.innerHTML = `<h3>${jornadaLimpia} ${ultimo.infoJornada.split(" ")[2]}</h3>`;
          teamContainer.appendChild(lastTitle);

          const lastDetails = document.createElement("div");
          lastDetails.className = "detailsDiv";
          
          const esCasa = ultimo.rival.includes("(C)");
          const rivalLimpio = ultimo.rival.replace("(C)", "").replace("(F)", "").trim();

          ultimo.resultado = ultimo.resultado.replace("P", "");
          ultimo.resultado = ultimo.resultado.replace("G", "");

          const rival = rivalLimpio.replace('"', "").replace('"', '').trim();

          lastDetails.innerHTML = `
              <div class="nombreEquipo partido ${esCasa ? 'verde' : ''}">${esCasa ? formatearNombreEquipo(nombreOficial) : formatearNombreEquipo(rival)}</div>
              <div class="partido" style="font-size: 25px; font-style: italic; width: fit-content; white-space: nowrap;">${ultimo.resultado}</div>
              <div class="nombreEquipo partido ${!esCasa ? 'verde' : ''}">${!esCasa ? formatearNombreEquipo(nombreOficial) : formatearNombreEquipo(rival)}</div>
          `;
          teamContainer.appendChild(lastDetails);
        }

        // --- 3. Bloque Próximo Partido ---
        if (proximo) {
          const nextTitle = document.createElement("div");
          nextTitle.className = "titleInfo";

          var jornadaLimpia = proximo.infoJornada.split(' ')[0] + " " + proximo.infoJornada.split(' ')[1]

          var fecha = proximo.resultado.split(' ')[0].replace(/(\d{1,2})\/(\d{1,2})\/(\d{4})/, (match, d, m, y) => {
              const dia = d.padStart(2, '0');
              const mes = m.padStart(2, '0');
              return `${dia}/${mes}/${y}`;
          });

          var hora = proximo.resultado.split(' ')[1];

          nextTitle.innerHTML = `<h3>${jornadaLimpia} (${fecha})</h3>`;
          teamContainer.appendChild(nextTitle);

          const nextDetails = document.createElement("div");
          nextDetails.className = "detailsDiv";

          const esCasaProx = proximo.rival.includes("(C)");
          const rivalProxLimpio = proximo.rival.replace("(C)", "").replace("(F)", "").trim();

          const rivalProx = rivalProxLimpio.replace('"', "").replace('"', '').trim();

          nextDetails.innerHTML = `
              <div class="nombreEquipo partido ${esCasaProx ? 'verde' : ''}">${esCasaProx ? formatearNombreEquipo(nombreOficial) : formatearNombreEquipo(rivalProx)}</div>
              <div class="partido" style="font-size: 25px; font-style: italic; width: fit-content;">${hora}</div>
              <div class="nombreEquipo partido ${!esCasaProx ? 'verde' : ''}">${!esCasaProx ? formatearNombreEquipo(nombreOficial) : formatearNombreEquipo(rivalProx)}</div>
          `;
          teamContainer.appendChild(nextDetails);
        }

        try {
          const refClas = doc(db, "seguimiento_futbol", "clasificacion_indartsu");
          const snapClas = await getDoc(refClas);

          if (snapClas.exists()) {
            const data = snapClas.data();
            const tablaData = data.tabla;
            const nextTitle = document.createElement("div");
            nextTitle.className = "titleInfo";
            nextTitle.innerHTML = `<h3>CLASIFICACIÓN</h3>`;
            teamContainer.appendChild(nextTitle);

            const containerClasificacion = document.createElement("div");
            containerClasificacion.style.padding = "10px";
            containerClasificacion.style.borderRadius = "10px";
            containerClasificacion.style.backgroundColor = "#444444";
            teamContainer.appendChild(containerClasificacion);

            const containerFila1 = document.createElement("div");
            // 1. Forzamos a que sea una fila horizontal que ocupe todo el ancho
            containerFila1.style.display = "flex";
            containerFila1.style.width = "100%";
            containerFila1.style.alignItems = "center";
            containerFila1.style.marginBottom = "10px";
            containerFila1.style.padding = "0";

            const posi = document.createElement("div");
            const nombre = document.createElement("div");
            const puntos = document.createElement("div");

            // posi.style.minWidth = "30px" // Ancho fijo para que todos los números queden alineados
            posi.style.fontWeight = "bold";
            posi.style.backgroundColor = "#292929"
            posi.style.borderRadius = "10px";
            posi.style.width = "18%";
            posi.style.height = "50px";
            posi.style.display = "flex";
            posi.style.alignItems = "center";   // Centrado vertical
            posi.style.justifyContent = "center"; // Centrado horizontal
            posi.innerHTML = `POS`;

            nombre.style.flexGrow = "1";
            nombre.style.textAlign = "left";
            nombre.style.backgroundColor = "#292929"
            nombre.style.borderRadius = "10px";
            nombre.style.marginLeft = "5px";
            nombre.style.paddingLeft = "15px";
            nombre.style.height = "50px";
            nombre.style.display = "flex";
            nombre.style.alignItems = "center";
            nombre.style.fontWeight = "bold";
            nombre.innerHTML = "EQUIPO";

            puntos.style.width = "18%";
            puntos.style.fontWeight = "bold";
            puntos.style.backgroundColor = "#292929"
            puntos.style.borderRadius = "10px";
            puntos.style.height = "50px";
            puntos.style.display = "flex";
            puntos.style.alignItems = "center";   // Centrado vertical
            puntos.style.justifyContent = "center"; // Centrado horizontal
            puntos.style.marginLeft = "5px";
            puntos.innerHTML = `PTS`;

            containerFila1.appendChild(posi);
            containerFila1.appendChild(nombre);
            containerFila1.appendChild(puntos);

            containerClasificacion.appendChild(containerFila1);

            let posicion = 1;

            tablaData.forEach(element => {
              const containerFila = document.createElement("div");
              // 1. Forzamos a que sea una fila horizontal que ocupe todo el ancho
              containerFila.style.display = "flex";
              containerFila.style.width = "100%";
              containerFila.style.alignItems = "center";
              containerFila.style.marginBottom = "10px";
              containerFila.style.padding = "0"; 
              // containerFila.style.backgroundColor = "#333333";
              
              // Opcional: añade tu clase para que tenga el fondo gris que usas en otros lados
              containerFila.className = "partido"; 

              const pos = document.createElement("div");
              // pos.style.minWidth = "fit-content"
              pos.style.fontWeight = "bold";
              pos.style.backgroundColor = "#333333"
              pos.style.borderRadius = "10px";
              pos.style.width = "18%";
              pos.style.height = "50px";
              pos.style.display = "flex";
              pos.style.alignItems = "center";   // Centrado vertical
              pos.style.justifyContent = "center"; // Centrado horizontal
              pos.innerHTML = `${posicion++}`;
              if (element.nombre == "INDARTSU") {
                pos.classList.add("verde");
              }
              if (posicion > 17) {
                pos.style.backgroundColor = "#552222";
              } else if (posicion < 4) {
                pos.style.backgroundColor = "#113311";
              }
              containerFila.appendChild(pos);

              const nombreEq = document.createElement("div");
              // 2. Usamos flex-grow para que el nombre ocupe el espacio restante
              nombreEq.style.flexGrow = "1";
              nombreEq.style.textAlign = "left";
              nombreEq.style.backgroundColor = "#333333"
              nombreEq.style.borderRadius = "10px";
              nombreEq.style.marginLeft = "5px";
              nombreEq.style.paddingLeft = "15px";
              nombreEq.style.height = "50px";
              nombreEq.style.display = "flex";
              nombreEq.style.alignItems = "center";   // Centrado vertical
              
              const nombreLimpio = element.nombre.replace(/"/g, '').trim();
              nombreEq.innerHTML = formatearNombreEquipo(nombreLimpio);
              if (element.nombre == "INDARTSU") {
                nombreEq.classList.add("verde");
                nombreEq.innerHTML = "Indartsu Club";
              } else if (element.nombre == "LEMOAHARROBI") {
                nombreEq.innerHTML = "Lemoa Harrobi";
              }
              if (posicion > 17) {
                nombreEq.style.backgroundColor = "#552222";
              } else if (posicion < 4) {
                nombreEq.style.backgroundColor = "#113311";
              }
              containerFila.appendChild(nombreEq);

              const puntos = document.createElement("div");
              let pts = parseInt(element.EmpatadosCasa) + parseInt(element.EmpatadosFuera) + parseInt((element.GanadosCasa * 3)) + parseInt((element.GanadosFuera * 3));
              puntos.innerHTML = `${pts}`;
              puntos.style.width = "18%";
              puntos.style.fontWeight = "bold";
              puntos.style.backgroundColor = "#333333"
              puntos.style.borderRadius = "10px";
              puntos.style.height = "50px";
              puntos.style.display = "flex";
              puntos.style.alignItems = "center";   // Centrado vertical
              puntos.style.justifyContent = "center"; // Centrado horizontal
              puntos.style.marginLeft = "5px";
              if (element.nombre == "INDARTSU") {
                puntos.classList.add("verde");
              }
              if (posicion > 17) {
                puntos.style.backgroundColor = "#552222";
              } else if (posicion < 4) {
                puntos.style.backgroundColor = "#113311";
              }
              containerFila.appendChild(puntos);

              containerFila.addEventListener("click", () => {
                const pj = parseInt(element.GanadosCasa) + parseInt(element.GanadosFuera) + 
                parseInt(element.EmpatadosCasa) + parseInt(element.EmpatadosFuera) + 
                parseInt(element.PerdidosCasa) + parseInt(element.PerdidosFuera);
    
                const pg = parseInt(element.GanadosCasa) + parseInt(element.GanadosFuera);
                const pe = parseInt(element.EmpatadosCasa) + parseInt(element.EmpatadosFuera);
                const pp = parseInt(element.PerdidosCasa) + parseInt(element.PerdidosFuera);

                // Verificamos si ya estamos mostrando las estadísticas buscando un ID o clase específica
                const yaExpandido = nombreEq.querySelector(".stats-container");

                if (yaExpandido) {
                    // Si ya está expandido, volvemos al estado original
                    nombreEq.style.flexGrow = "1";
                    nombreEq.style.textAlign = "left";
                    nombreEq.style.backgroundColor = cargarColor(pos.innerText);
                    nombreEq.style.borderRadius = "10px";
                    nombreEq.style.marginLeft = "5px";
                    nombreEq.style.paddingLeft = "15px";
                    nombreEq.style.height = "50px";
                    nombreEq.style.display = "flex";
                    nombreEq.style.alignItems = "center"; 
                    nombreEq.style.flexDirection = "row";
                    
                    pos.style.height = "50px";
                    puntos.style.height = "50px";
                    nombreEq.innerHTML = element.nombre === "INDARTSU" ? "Indartsu Club" : formatearNombreEquipo(nombreLimpio);
                } else {
                    // Aumentamos la altura para que quepan las 3 líneas (Nombre + PJ + G/E/P)
                    nombreEq.style.height = "auto"; 
                    nombreEq.style.paddingTop = "10px";
                    nombreEq.style.paddingBottom = "10px";
                    nombreEq.style.paddingRight = "15px";

                    nombreEq.style.display = "flex";
                    nombreEq.style.flexDirection = "column";

                    nombreEq.innerHTML = `
                        <span style="font-size: 1rem; font-weight: bold; margin-bottom: 12px; color: ${element.nombre === "INDARTSU" ? "#00ff88" : "white"}; width: 100%; text-align: left; text-decoration: underline;">
                            ${element.nombre === "INDARTSU" ? "Indartsu Club" : formatearNombreEquipo(nombreLimpio)}
                        </span>

                        <div style="position: relative; width: 100%; padding: 15px 10px 10px 10px; border: 2px solid ${element.nombre === "INDARTSU" ? "#00ff88" : "white"}; border-radius: 8px; margin-top: 5px;">
                            
                            <span style="position: absolute; top: -10px; left: 10px; background-color: ${cargarColor(pos.innerText)}; padding: 0 5px; font-size: 0.8rem; color: ${element.nombre === "INDARTSU" ? "#00ff88" : "white"};">
                                <strong>Jugados: </strong><i>${pj}</i>
                            </span>
                            
                            <div class="stats-container" style="display: flex; flex-direction: column; gap: 8px;">
                                <div style="display: flex; width: 100%; font-size: 0.75rem; color: ${element.nombre === "INDARTSU" ? "#00ff88" : "white"};">
                                    <span style="flex: 1;"><strong>G:</strong> <i>${pg}</i></span>
                                    <span style="flex: 1; text-align: center;"><strong>E:</strong> <i>${pe}</i></span>
                                    <span style="flex: 1; text-align: right;"><strong>P:</strong> <i>${pp}</i></span>
                                </div>

                                <div style="display: flex; width: 100%; font-size: 0.75rem; color: ${element.nombre === "INDARTSU" ? "#00ff88" : "white"}; border-top: 2px solid ${element.nombre === "INDARTSU" ? "#00ff88" : "white"}; pt: 5px; margin-top: 2px; padding-top: 5px;">
                                    <span style="flex: 1;"><strong>GF:</strong> <i>${element.GolesFavor}</i></span>
                                    <span style="flex: 1; text-align: right;"><strong>GC:</strong> <i>${element.GolesContra}</i></span>
                                </div>
                            </div>
                        </div>
                    `;

                    pos.style.height = nombreEq.scrollHeight + "px";
                    puntos.style.height = nombreEq.scrollHeight + "px";
                }
              });

              containerClasificacion.appendChild(containerFila);
          });
          }
        } catch (error) {
          // Salta el bloque de clasificación si hay error
        }
      }

      const nextTitle = document.createElement("div");
      nextTitle.style.display = "flex";

      const mediaQuery = window.matchMedia("(min-width: 600px)");

      const containerAscensoDirecto = document.createElement("div");
      containerAscensoDirecto.style.width = "auto";
      containerAscensoDirecto.style.marginRight = "15px";
      containerAscensoDirecto.style.marginBottom = "8px";

      const containerAscensoPlayOff = document.createElement("div");
      containerAscensoPlayOff.style.width = "auto";
      containerAscensoPlayOff.style.marginRight = "15px";
      const containerDescensoPlayOff = document.createElement("div");
      containerDescensoPlayOff.style.width = "auto";
      containerDescensoPlayOff.style.marginRight = "15px";
      const containerDescenso = document.createElement("div");
      containerDescenso.style.width = "auto";

      // 1. Configurar el contenedor como Flexbox
      containerAscensoDirecto.style.display = "flex";
      containerAscensoDirecto.style.alignItems = "center"; // Centra verticalmente el cuadradito con el texto
      containerAscensoDirecto.style.gap = "8px"; // Añade una separación entre el cuadro y el texto

      // 2. El cuadrado de color
      const divAscensoDirecto = document.createElement("div");
      divAscensoDirecto.style.backgroundColor = "#113311";
      divAscensoDirecto.style.width = "18px";
      divAscensoDirecto.style.height = "18px";
      divAscensoDirecto.style.borderRadius = "5px";
      // Evitar que el flex lo encoja si el texto es muy largo
      divAscensoDirecto.style.flexShrink = "0"; 

      containerAscensoDirecto.appendChild(divAscensoDirecto);

      // 3. El texto
      const p = document.createElement("p");
      p.innerText = "Ascenso";
      // Quitamos los márgenes por defecto del <p> para que no rompa la alineación
      p.style.margin = "0";
      p.style.fontWeight = "bold"; 
      p.style.fontSize = "12px";

      containerAscensoDirecto.appendChild(p);

      // 4. Añadir al título
      nextTitle.appendChild(containerAscensoDirecto);

      // --- Bloque Ascenso PlayOff ---
      containerAscensoPlayOff.style.display = "flex";
      containerAscensoPlayOff.style.alignItems = "center";
      containerAscensoPlayOff.style.gap = "8px";
      containerAscensoPlayOff.style.marginBottom = "8px";
      containerAscensoPlayOff.style.justifyContent = "flex-end";

      const divAscensoPlayOff = document.createElement("div");
      divAscensoPlayOff.style.backgroundColor = "#448844";
      divAscensoPlayOff.style.width = "18px";
      divAscensoPlayOff.style.height = "18px";
      divAscensoPlayOff.style.borderRadius = "5px";
      divAscensoPlayOff.style.flexShrink = "0";

      const pPlayOff = document.createElement("p");
      pPlayOff.innerText = "PlayOff de Ascenso";
      pPlayOff.style.margin = "0";
      pPlayOff.style.fontWeight = "bold"; 
      pPlayOff.style.fontSize = "12px";

      containerAscensoPlayOff.appendChild(divAscensoPlayOff);
      containerAscensoPlayOff.appendChild(pPlayOff);
      nextTitle.appendChild(containerAscensoPlayOff);


      // --- Bloque Descenso PlayOff ---
      containerDescensoPlayOff.style.display = "flex";
      containerDescensoPlayOff.style.alignItems = "center";
      containerDescensoPlayOff.style.gap = "8px";
      containerDescensoPlayOff.style.marginBottom = "8px";

      const divDescensoPlayOff = document.createElement("div");
      divDescensoPlayOff.style.backgroundColor = "#CCAA55";
      divDescensoPlayOff.style.width = "18px";
      divDescensoPlayOff.style.height = "18px";
      divDescensoPlayOff.style.borderRadius = "5px";
      divDescensoPlayOff.style.flexShrink = "0";

      const pDescensoPO = document.createElement("p");
      pDescensoPO.innerText = "PlayOff de Descenso";
      pDescensoPO.style.margin = "0";
      pDescensoPO.style.fontWeight = "bold"; 
      pDescensoPO.style.fontSize = "12px";

      containerDescensoPlayOff.appendChild(divDescensoPlayOff);
      containerDescensoPlayOff.appendChild(pDescensoPO);
      nextTitle.appendChild(containerDescensoPlayOff);


      // --- Bloque Descenso Directo ---
      containerDescenso.style.display = "flex";
      containerDescenso.style.alignItems = "center";
      containerDescenso.style.gap = "8px";
      containerDescenso.style.marginBottom = "8px";
      containerDescenso.style.justifyContent = "flex-end";

      const divDescenso = document.createElement("div");
      divDescenso.style.backgroundColor = "#552222";
      divDescenso.style.width = "18px";
      divDescenso.style.height = "18px";
      divDescenso.style.borderRadius = "5px";
      divDescenso.style.flexShrink = "0";

      const pDescenso = document.createElement("p");
      pDescenso.innerText = "Descenso";
      pDescenso.style.margin = "0";
      pDescenso.style.fontWeight = "bold"; 
      pDescenso.style.fontSize = "12px";

      
      containerDescenso.appendChild(divDescenso);
      containerDescenso.appendChild(pDescenso);
      nextTitle.appendChild(containerDescenso);

      teamContainer.appendChild(nextTitle);

      function handleTabletChange(e) {
        // 1. Forzamos el contenedor padre a ocupar todo el ancho y permitir saltos de línea
        nextTitle.style.display = "flex";
        nextTitle.style.flexWrap = "wrap"; 
        nextTitle.style.width = "100%"; // Crucial para que el wrap funcione

        if (e.matches) {
            // PANTALLA ANCHA: Todo en una fila
            nextTitle.style.flexDirection = "row";

            containerAscensoPlayOff.removeChild(pPlayOff);
            containerDescenso.removeChild(pDescenso);

            containerAscensoPlayOff.appendChild(pPlayOff);
            containerDescenso.appendChild(pDescenso);
            
            [containerAscensoDirecto, containerAscensoPlayOff, containerDescensoPlayOff, containerDescenso].forEach(c => {
                if(c) {
                    c.style.flex = "0 1 auto"; 
                    c.style.width = "auto";
                    c.style.marginRight = "15px";
                }
            });
        } else {
            // MÓVIL: 2 por fila (Rejilla 2x2)
            nextTitle.style.flexDirection = "row";

            containerAscensoPlayOff.removeChild(divAscensoPlayOff);
            containerDescenso.removeChild(divDescenso);

            containerAscensoPlayOff.appendChild(divAscensoPlayOff);
            containerDescenso.appendChild(divDescenso);
            
            [containerAscensoDirecto, containerAscensoPlayOff, containerDescensoPlayOff, containerDescenso].forEach(c => {
                if(c) {
                    // Forzamos el 50% exacto usando border-box
                    c.style.boxSizing = "border-box";
                    c.style.flex = "0 0 50%"; 
                    c.style.width = "50%";
                    
                    // Quitamos el margin derecho que pusiste arriba para que no sume ancho extra
                    c.style.marginRight = "0px";
                    c.style.paddingRight = "5px"; // Usamos padding para separar sin romper el 50%
                }
            });
        }
      }

      // Escuchar cambios de tamaño
      mediaQuery.addListener(handleTabletChange);

      // Ejecutar al inicio
      handleTabletChange(mediaQuery);

      const schedule = document.createElement("div");
      schedule.className = "titleInfo";
      schedule.innerHTML = `<h3>CALENDARIO</h3>`;
      teamContainer.appendChild(schedule);

      } else {
        teamContainer.innerHTML = `<p>No se encontraron estadísticas para este equipo.</p>`;
      }
    } catch (error) {
      console.error("Error Firebase:", error);
      teamContainer.innerHTML = "<p>Error al conectar con la base de datos.</p>";
    }
  }

  function formatearNombreEquipo(texto) {
    if (!texto) return "";

    return texto.toLowerCase().split(' ').map(palabra => {
        // Si la palabra contiene comillas, la devolvemos en mayúsculas
        if (palabra.includes('"')) {
            return palabra.toUpperCase();
        }
        // Si es una palabra normal, ponemos en mayúscula solo la primera letra
        return palabra.charAt(0).toUpperCase() + palabra.slice(1);
    }).join(' ');
}

  function cargarColor(posicion) {
    if (posicion >= 17) {
      return "#552222";
    } else if (posicion <= 2) {
      return "#113311";
    } else {
      return "#333333";
    }
  }

  function cargarColorCart(posicion) {
    if (posicion >= 16) {
      return "#552222";
    } else if (posicion <= 1) {
      return "#113311";
    } else if (posicion <= 5) {
      return "#448844"
    } else {
      return "#333333";
    }
  }

  function cargarColorPref(posicion, equipo) {
    if (equipo == "SD Eibar B") {
      if (posicion >= 14) {
        return "#552222";
      } else if (posicion <= 1) {
        return "#113311";
      } else if (posicion == 13) {
        return "#CCAA55"
      } else if (posicion <= 5) {
        return "#448844"
      } else {
        return "#333333";
      }
    } else if (equipo == "CD Derio") {
      if (posicion >= 16) {
        return "#552222";
      } else if (posicion <= 1) {
        return "#113311";
      } else if (posicion <= 5) {
        return "#448844"
      } else {
        return "#333333";
      }
    }
  }

  cargarEquipo();
</script>
  
</body>
</html>